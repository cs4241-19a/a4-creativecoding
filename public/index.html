<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="css/style.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/1f29d09d72.js"></script>



    <title>creative coding -- a4-hcaouette -- CS4241 Assignment 4</title>
  </head>
  <body>
    <!--top level container object, encompasses the entire page-->
    <div class="container-fluid snapCont">

      <!--navigation bar-->
      <!-- <span class="headerIns"></span> -->
      <nav class="navbar navbar-expand-lg navbar-light justify-content-between">
        <div class="container-fluid">
        <div class="nav">
          <a class="navbar-brand" href="https://github.com/hcaouette/a3-persistence">
            <img src="https://i.imgur.com/bfmHsdG.jpg" width="50" height="60" class="d-inline-block align-top" alt="small image of Hunter for navigation bar">
            <span>Hunter Caouette</span>
          </a>
          <a class="nav-item nav-link active" href="/index.html">Home</a>
          <a class="nav-item nav-link active" href="/cheeses.html">Cheeses</a>
          <a class="nav-item nav-link active" href="/about.html">About</a>
        </div>
        <div class="nav">
          <a class="nav-item nav-link active" href="/cart.html">Cart</a>
          <a class="nav-item nav-link active" href="/auth/google">Log In</a>
        </div>
      </div>
      </nav>


      <!--main content-->
      <!--row 1-->
      <!-- <div class="row justify-content-center snapChil">
        <div class="col centerBox">
          <h1>Hunter Caouette's Cheese World</h1>
          <h2>Welcome to the cheese world!</h2>
        </div> -->
      </div><!--close row 1-->

      <canvas id="canvas" width="512" height="256" ></canvas>

       <p id="controls">
         <input type="button" id="start_button" value="Start">
         &nbsp; &nbsp;
         <input type="button" id="stop_button" value="Stop">
         <p id="msg"></p>
       </p>

       <!-- ----------------------------------------------------- -->

       <style>
           #canvas {
               margin-left: auto;
               margin-right: auto;
               display: block;
               background-color: black;
           }
           #controls {
               text-align: center;
           }
           #start_button, #stop_button {
               font-size: 16pt;
           }
           #msg {
               text-align: center;
           }
       </style>

       <!-- ----------------------------------------------------- -->


       <script type="text/javascript">
           // Hacks to deal with different function names in different browsers
           window.requestAnimFrame = (function(){
             return  window.requestAnimationFrame       ||
                     window.webkitRequestAnimationFrame ||
                     window.mozRequestAnimationFrame    ||
                     function(callback, element){
                       window.setTimeout(callback, 1000 / 60);
                     };
           })();
           window.AudioContext = (function(){
               return  window.webkitAudioContext || window.AudioContext || window.mozAudioContext;
           })();
           // Global Variables for Audio
           var audioContext;
           var audioBuffer;
           var sourceNode;
           var analyserNode;
           var javascriptNode;
           var audioData = null;
           var audioPlaying = false;
           var sampleSize = 1024;  // number of samples to collect before analyzing data
           var amplitudeArray;     // array to hold time domain data
           // This must be hosted on the same server as this page - otherwise you get a Cross Site Scripting error
           var audioUrl = "viper.mp3";
           // Global Variables for the Graphics
           var canvasWidth  = 512;
           var canvasHeight = 256;
           var ctx;
           $(document).ready(function() {
               ctx = $("#canvas").get()[0].getContext("2d");
               // the AudioContext is the primary 'container' for all your audio node objects
               try {
                   audioContext = new AudioContext();
               } catch(e) {
                   alert('Web Audio API is not supported in this browser');
               }
               // When the Start button is clicked, finish setting up the audio nodes, play the sound,
               // gather samples for the analysis, update the canvas
               $("#start_button").on('click', function(e) {
                   e.preventDefault();
                   // Set up the audio Analyser, the Source Buffer and javascriptNode
                   setupAudioNodes();
                   // setup the event handler that is triggered every time enough samples have been collected
                   // trigger the audio analysis and draw the results
                   javascriptNode.onaudioprocess = function () {
                       // get the Time Domain data for this sample
                       analyserNode.getByteTimeDomainData(amplitudeArray);
                       // draw the display if the audio is playing
                       if (audioPlaying == true) {
                           requestAnimFrame(drawTimeDomain);
                       }
                   }
                   // Load the Audio the first time through, otherwise play it from the buffer
                   if(audioData == null) {
                       loadSound(audioUrl);
                   } else {
                       playSound(audioData);
                   }
               });
               // Stop the audio playing
               $("#stop_button").on('click', function(e) {
                   e.preventDefault();
                   sourceNode.stop(0);
                   audioPlaying = false;
               });
           });
           function setupAudioNodes() {
               sourceNode     = audioContext.createBufferSource();
               analyserNode   = audioContext.createAnalyser();
               javascriptNode = audioContext.createScriptProcessor(sampleSize, 1, 1);
               // Create the array for the data values
               amplitudeArray = new Uint8Array(analyserNode.frequencyBinCount);
               // Now connect the nodes together
               sourceNode.connect(audioContext.destination);
               sourceNode.connect(analyserNode);
               analyserNode.connect(javascriptNode);
               javascriptNode.connect(audioContext.destination);
           }
           // Load the audio from the URL via Ajax and store it in global variable audioData
           // Note that the audio load is asynchronous
           function loadSound(url) {
               document.getElementById('msg').textContent = "Loading audio...";
               var request = new XMLHttpRequest();
               request.open('GET', url, true);
               request.responseType = 'arraybuffer';
               // When loaded, decode the data and play the sound
               request.onload = function () {
                   audioContext.decodeAudioData(request.response, function (buffer) {
                       document.getElementById('msg').textContent = "Audio sample download finished";
                       audioData = buffer;
                       playSound(audioData);
                   }, onError);
               }
               request.send();
           }
           // Play the audio and loop until stopped
           function playSound(buffer) {
               sourceNode.buffer = buffer;
               sourceNode.start(0);    // Play the sound now
               sourceNode.loop = true;
               audioPlaying = true;
           }
           function onError(e) {
               console.log(e);
           }
           function drawTimeDomain() {
               clearCanvas();
               for (var i = 0; i < amplitudeArray.length; i++) {
                   var value = amplitudeArray[i] / 256;
                   var y = canvasHeight - (canvasHeight * value) - 1;
                   ctx.fillStyle = '#ffffff';
                   ctx.fillRect(i, y, 1, 1);
               }
           }
           function clearCanvas() {
               ctx.clearRect(0, 0, canvasWidth, canvasHeight);
           }
       </script>



    </div><!--end container-->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="/js/scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>
